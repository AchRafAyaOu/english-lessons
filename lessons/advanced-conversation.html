<div class="lesson-content">
  <div class="lesson-header">
    <h1 class="lesson-title">الدرس السادس: المحادثة المتقدمة</h1>
    <p class="lesson-description">طور مهارات المحادثة لديك من خلال حوارات متقدمة ومواقف حياتية متنوعة</p>
  </div>

  <div class="lesson-sections">
    <!-- قسم المحادثات اليومية -->
    <div class="lesson-section">
      <h2 class="section-title">
        <i class="fas fa-comments"></i>
        المحادثات اليومية
      </h2>
      
      <div class="conversation-scenarios">
        <div class="scenario-card">
          <h3>في المطعم</h3>
          <div class="dialogue-container">
            <div class="dialogue-role waiter">
              <div class="role-name">النادل</div>
              <div class="dialogue-text">
                <div class="english">Good evening! Welcome to our restaurant. How many people?</div>
                <div class="arabic">مساء الخير! مرحباً بكم في مطعمنا. كم شخص؟</div>
              </div>
            </div>
            
            <div class="dialogue-role customer">
              <div class="role-name">الزبون</div>
              <div class="dialogue-text">
                <div class="english">Good evening. Table for two, please.</div>
                <div class="arabic">مساء الخير. طاولة لشخصين، من فضلك.</div>
              </div>
            </div>
            
            <div class="dialogue-role waiter">
              <div class="role-name">النادل</div>
              <div class="dialogue-text">
                <div class="english">Follow me, please. Here's your table. Can I get you something to drink?</div>
                <div class="arabic">تفضلوا معي، من فضلكم. هذه طاولتكم. هل يمكنني أن أحضر لكم شيئاً للشرب؟</div>
              </div>
            </div>
            
            <div class="dialogue-role customer">
              <div class="role-name">الزبون</div>
              <div class="dialogue-text">
                <div class="english">I'll have water, and she'll have orange juice, please.</div>
                <div class="arabic">سأتناول الماء، وهي ستتناول عصير برتقال، من فضلك.</div>
              </div>
            </div>
          </div>
          <button class="play-dialogue-btn" onclick="playDialogue('restaurant')">
            <i class="fas fa-play"></i>
            تشغيل المحادثة
          </button>
        </div>
        
        <div class="scenario-card">
          <h3>في المتجر</h3>
          <div class="dialogue-container">
            <div class="dialogue-role salesperson">
              <div class="role-name">البائع</div>
              <div class="dialogue-text">
                <div class="english">Good morning! Can I help you?</div>
                <div class="arabic">صباح الخير! هل يمكنني مساعدتك؟</div>
              </div>
            </div>
            
            <div class="dialogue-role customer">
              <div class="role-name">الزبون</div>
              <div class="dialogue-text">
                <div class="english">Yes, I'm looking for a blue shirt, size medium.</div>
                <div class="arabic">نعم، أبحث عن قميص أزرق، مقاس متوسط.</div>
              </div>
            </div>
            
            <div class="dialogue-role salesperson">
              <div class="role-name">البائع</div>
              <div class="dialogue-text">
                <div class="english">Here you are. Would you like to try it on?</div>
                <div class="arabic">ها هو. هل تريد أن تجربه؟</div>
              </div>
            </div>
            
            <div class="dialogue-role customer">
              <div class="role-name">الزبون</div>
              <div class="dialogue-text">
                <div class="english">Yes, please. Where's the fitting room?</div>
                <div class="arabic">نعم، من فضلك. أين غرفة القياس؟</div>
              </div>
            </div>
          </div>
          <button class="play-dialogue-btn" onclick="playDialogue('shopping')">
            <i class="fas fa-play"></i>
            تشغيل المحادثة
          </button>
        </div>
        
        <div class="scenario-card">
          <h3>في المكتب</h3>
          <div class="dialogue-container">
            <div class="dialogue-role manager">
              <div class="role-name">المدير</div>
              <div class="dialogue-text">
                <div class="english">Good morning, Sarah. How was your weekend?</div>
                <div class="arabic">صباح الخير، سارة. كيف كان عطلة نهاية الأسبوع؟</div>
              </div>
            </div>
            
            <div class="dialogue-role employee">
              <div class="role-name">الموظف</div>
              <div class="dialogue-text">
                <div class="english">Good morning! It was great, thank you. I visited my family.</div>
                <div class="arabic">صباح الخير! كانت رائعة، شكراً لك. زرت عائلتي.</div>
              </div>
            </div>
            
            <div class="dialogue-role manager">
              <div class="role-name">المدير</div>
              <div class="dialogue-text">
                <div class="english">That's nice. Are you ready for today's meeting?</div>
                <div class="arabic">هذا جميل. هل أنت مستعدة لاجتماع اليوم؟</div>
              </div>
            </div>
            
            <div class="dialogue-role employee">
              <div class="role-name">الموظف</div>
              <div class="dialogue-text">
                <div class="english">Yes, I've prepared the presentation. It's ready.</div>
                <div class="arabic">نعم، لقد أعددت العرض التقديمي. إنه جاهز.</div>
              </div>
            </div>
          </div>
          <button class="play-dialogue-btn" onclick="playDialogue('office')">
            <i class="fas fa-play"></i>
            تشغيل المحادثة
          </button>
        </div>
      </div>
    </div>

    <!-- قسم التعبيرات المتقدمة -->
    <div class="lesson-section">
      <h2 class="section-title">
        <i class="fas fa-brain"></i>
        التعبيرات المتقدمة
      </h2>
      
      <div class="expressions-categories">
        <div class="expression-category">
          <h3>التعبير عن الرأي</h3>
          <div class="expressions-list">
            <div class="expression-item">
              <div class="expression-english">I think that...</div>
              <div class="expression-arabic">أعتقد أن...</div>
              <div class="expression-example">I think that this movie is great.</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">In my opinion...</div>
              <div class="expression-arabic">في رأيي...</div>
              <div class="expression-example">In my opinion, the weather is perfect today.</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">I believe...</div>
              <div class="expression-arabic">أؤمن/أعتقد...</div>
              <div class="expression-example">I believe hard work pays off.</div>
            </div>
          </div>
        </div>
        
        <div class="expression-category">
          <h3>الاتفاق والاختلاف</h3>
          <div class="expressions-list">
            <div class="expression-item">
              <div class="expression-english">I agree with you.</div>
              <div class="expression-arabic">أتفق معك.</div>
              <div class="expression-example">I agree with you about the restaurant.</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">I disagree.</div>
              <div class="expression-arabic">لا أتفق.</div>
              <div class="expression-example">I disagree with that statement.</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">You're absolutely right.</div>
              <div class="expression-arabic">أنت محق تماماً.</div>
              <div class="expression-example">You're absolutely right about the timing.</div>
            </div>
          </div>
        </div>
        
        <div class="expression-category">
          <h3>طلب التوضيح</h3>
          <div class="expressions-list">
            <div class="expression-item">
              <div class="expression-english">Could you explain that?</div>
              <div class="expression-arabic">هل يمكنك شرح ذلك؟</div>
              <div class="expression-example">Could you explain that process again?</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">What do you mean?</div>
              <div class="expression-arabic">ماذا تقصد؟</div>
              <div class="expression-example">What do you mean by "urgent"?</div>
            </div>
            
            <div class="expression-item">
              <div class="expression-english">I don't understand.</div>
              <div class="expression-arabic">لا أفهم.</div>
              <div class="expression-example">I don't understand this instruction.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم لعبة لعب الأدوار -->
    <div class="lesson-section">
      <h2 class="section-title">
        <i class="fas fa-theater-masks"></i>
        لعبة لعب الأدوار
      </h2>
      
      <div class="role-play-game">
        <div class="game-instructions">
          <h3>🎭 اختر السيناريو وتدرب على المحادثة</h3>
          <p>اختر موقفاً وتدرب على المحادثة مع الذكاء الاصطناعي</p>
        </div>
        
        <div class="scenario-selector">
          <div class="scenario-option" onclick="selectScenario('doctor')">
            <div class="scenario-icon">👨‍⚕️</div>
            <div class="scenario-title">زيارة الطبيب</div>
            <div class="scenario-description">تدرب على وصف الأعراض والحديث مع الطبيب</div>
          </div>
          
          <div class="scenario-option" onclick="selectScenario('airport')">
            <div class="scenario-icon">✈️</div>
            <div class="scenario-title">في المطار</div>
            <div class="scenario-description">تعلم كيفية التعامل مع إجراءات المطار</div>
          </div>
          
          <div class="scenario-option" onclick="selectScenario('hotel')">
            <div class="scenario-icon">🏨</div>
            <div class="scenario-title">في الفندق</div>
            <div class="scenario-description">احجز غرفة واطلب الخدمات</div>
          </div>
          
          <div class="scenario-option" onclick="selectScenario('bank')">
            <div class="scenario-icon">🏦</div>
            <div class="scenario-title">في البنك</div>
            <div class="scenario-description">تعامل مع المعاملات المصرفية</div>
          </div>
        </div>
        
        <div class="conversation-area" id="conversation-area" style="display: none;">
          <div class="conversation-header">
            <h4 id="current-scenario">اختر سيناريو للبدء</h4>
            <button class="reset-btn" onclick="resetConversation()">إعادة تعيين</button>
          </div>
          
          <div class="conversation-messages" id="conversation-messages">
          </div>
          
          <div class="conversation-input">
            <div class="suggested-responses" id="suggested-responses">
            </div>
            <textarea id="user-input" placeholder="اكتب ردك هنا..."></textarea>
            <button class="send-btn" onclick="sendMessage()">إرسال</button>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الأخطاء الشائعة -->
    <div class="lesson-section">
      <h2 class="section-title">
        <i class="fas fa-exclamation-triangle"></i>
        الأخطاء الشائعة وتصحيحها
      </h2>
      
      <div class="common-mistakes">
        <div class="mistake-category">
          <h3>أخطاء في الأزمنة</h3>
          <div class="mistake-examples">
            <div class="mistake-item">
              <div class="wrong">
                <span class="label">خطأ:</span>
                <span class="text">I go to school yesterday.</span>
              </div>
              <div class="correct">
                <span class="label">صحيح:</span>
                <span class="text">I went to school yesterday.</span>
              </div>
              <div class="explanation">استخدم الماضي البسيط مع الكلمات الدالة على الماضي</div>
            </div>
            
            <div class="mistake-item">
              <div class="wrong">
                <span class="label">خطأ:</span>
                <span class="text">I will went tomorrow.</span>
              </div>
              <div class="correct">
                <span class="label">صحيح:</span>
                <span class="text">I will go tomorrow.</span>
              </div>
              <div class="explanation">استخدم المصدر بعد will</div>
            </div>
          </div>
        </div>
        
        <div class="mistake-category">
          <h3>أخطاء في حروف الجر</h3>
          <div class="mistake-examples">
            <div class="mistake-item">
              <div class="wrong">
                <span class="label">خطأ:</span>
                <span class="text">I'm good in English.</span>
              </div>
              <div class="correct">
                <span class="label">صحيح:</span>
                <span class="text">I'm good at English.</span>
              </div>
              <div class="explanation">استخدم "at" مع "good" للحديث عن المهارات</div>
            </div>
            
            <div class="mistake-item">
              <div class="wrong">
                <span class="label">خطأ:</span>
                <span class="text">I'm agree with you.</span>
              </div>
              <div class="correct">
                <span class="label">صحيح:</span>
                <span class="text">I agree with you.</span>
              </div>
              <div class="explanation">"Agree" فعل، لا يحتاج "am/is/are"</div>
            </div>
          </div>
        </div>
        
        <div class="mistake-category">
          <h3>أخطاء في النطق</h3>
          <div class="mistake-examples">
            <div class="mistake-item">
              <div class="wrong">
                <span class="label">خطأ:</span>
                <span class="text">Tree /tri/ (كما في العربية)</span>
              </div>
              <div class="correct">
                <span class="label">صحيح:</span>
                <span class="text">Tree /triː/ (صوت طويل)</span>
              </div>
              <div class="explanation">انتبه لطول الأصوات في الإنجليزية</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم التمارين -->
    <div class="lesson-section">
      <h2 class="section-title">
        <i class="fas fa-pencil-alt"></i>
        التمارين التفاعلية
      </h2>
      
      <div class="exercise-container">
        <div class="exercise-item">
          <h3>تمرين 1: اختر الرد المناسب</h3>
          <div class="exercise-question">
            <p>إذا قال شخص: "What do you think about the movie?"</p>
            <p>ما هو أفضل رد؟</p>
            <div class="exercise-options">
              <button class="option-btn" onclick="checkAnswer(this, false)">Yes, I do.</button>
              <button class="option-btn" onclick="checkAnswer(this, true)">I think it's great.</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">I'm fine, thanks.</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">Nice to meet you.</button>
            </div>
          </div>
        </div>
        
        <div class="exercise-item">
          <h3>تمرين 2: صحح الخطأ</h3>
          <div class="exercise-question">
            <p>صحح الجملة التالية: "I'm agree with you."</p>
            <div class="exercise-options">
              <button class="option-btn" onclick="checkAnswer(this, false)">I'm agreeing with you.</button>
              <button class="option-btn" onclick="checkAnswer(this, true)">I agree with you.</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">I'm agreed with you.</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">I was agree with you.</button>
            </div>
          </div>
        </div>
        
        <div class="exercise-item">
          <h3>تمرين 3: اختر التعبير المناسب للموقف</h3>
          <div class="exercise-question">
            <p>في المطعم، تريد أن تطلب الحساب. ماذا تقول؟</p>
            <div class="exercise-options">
              <button class="option-btn" onclick="checkAnswer(this, false)">Give me money.</button>
              <button class="option-btn" onclick="checkAnswer(this, true)">Could I have the bill, please?</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">I want to pay now.</button>
              <button class="option-btn" onclick="checkAnswer(this, false)">Money, please.</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="lesson-navigation">
    <button class="nav-btn prev-btn" onclick="previousLesson()">
      <i class="fas fa-arrow-right"></i>
      الدرس السابق
    </button>
    
    <button class="nav-btn complete-btn" onclick="completeLesson()">
      <i class="fas fa-trophy"></i>
      إتمام الدورة
    </button>
  </div>
</div>

<style>
.lesson-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  background: var(--bg-primary);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-lg);
}

.lesson-header {
  text-align: center;
  margin-bottom: 3rem;
  padding-bottom: 2rem;
  border-bottom: 2px solid var(--border-color);
}

.lesson-title {
  font-size: 2.5rem;
  color: var(--primary-color);
  margin-bottom: 1rem;
  font-weight: 800;
}

.lesson-description {
  font-size: 1.2rem;
  color: var(--text-light);
  line-height: 1.6;
}

.lesson-section {
  margin-bottom: 3rem;
  padding: 2rem;
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-light);
}

.section-title {
  font-size: 1.8rem;
  color: var(--text-color);
  margin-bottom: 2rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.conversation-scenarios {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
}

.scenario-card {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: 2rem;
  border: 2px solid var(--border-color);
  transition: var(--transition);
}

.scenario-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
  border-color: var(--primary-color);
}

.scenario-card h3 {
  color: var(--primary-color);
  margin-bottom: 1.5rem;
  font-size: 1.3rem;
  text-align: center;
}

.dialogue-container {
  margin-bottom: 2rem;
}

.dialogue-role {
  margin-bottom: 1rem;
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.role-name {
  background: var(--primary-color);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  font-size: 0.9rem;
  white-space: nowrap;
  min-width: 80px;
  text-align: center;
}

.dialogue-role.customer .role-name,
.dialogue-role.employee .role-name {
  background: var(--secondary-color);
}

.dialogue-text {
  background: var(--bg-secondary);
  padding: 1rem;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-light);
  flex: 1;
}

.dialogue-text .english {
  font-size: 1.1rem;
  color: var(--text-color);
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.dialogue-text .arabic {
  font-size: 1rem;
  color: var(--text-light);
}

.play-dialogue-btn {
  background: linear-gradient(135deg, var(--success-color), var(--secondary-color));
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: var(--border-radius);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0 auto;
}

.play-dialogue-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.expressions-categories {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 2rem;
}

.expression-category {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  border: 2px solid var(--border-color);
}

.expression-category h3 {
  color: var(--secondary-color);
  margin-bottom: 1rem;
  font-size: 1.2rem;
  text-align: center;
}

.expressions-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.expression-item {
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  padding: 1rem;
  border: 1px solid var(--border-light);
  transition: var(--transition);
}

.expression-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.expression-english {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--primary-color);
  margin-bottom: 0.5rem;
}

.expression-arabic {
  font-size: 1rem;
  color: var(--text-color);
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.expression-example {
  font-size: 0.9rem;
  color: var(--text-light);
  font-style: italic;
}

.role-play-game {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: 2rem;
  border: 2px solid var(--border-color);
}

.game-instructions {
  text-align: center;
  margin-bottom: 2rem;
}

.game-instructions h3 {
  color: var(--primary-color);
  margin-bottom: 1rem;
}

.game-instructions p {
  color: var(--text-light);
}

.scenario-selector {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.scenario-option {
  background: var(--bg-secondary);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}

.scenario-option:hover {
  transform: translateY(-3px);
  border-color: var(--primary-color);
  box-shadow: var(--shadow);
}

.scenario-option.selected {
  border-color: var(--primary-color);
  background: rgba(52, 152, 219, 0.1);
}

.scenario-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.scenario-title {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 0.5rem;
}

.scenario-description {
  font-size: 0.9rem;
  color: var(--text-light);
  line-height: 1.4;
}

.conversation-area {
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  border: 1px solid var(--border-light);
}

.conversation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-light);
}

.conversation-header h4 {
  color: var(--primary-color);
  font-size: 1.2rem;
}

.reset-btn {
  background: var(--danger-color);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 0.9rem;
  transition: var(--transition);
}

.reset-btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow);
}

.conversation-messages {
  max-height: 400px;
  overflow-y: auto;
  margin-bottom: 1rem;
  padding: 1rem;
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-light);
}

.message {
  margin-bottom: 1rem;
  padding: 1rem;
  border-radius: var(--border-radius);
  animation: fadeIn 0.3s ease;
}

.message.ai {
  background: var(--primary-color);
  color: white;
  margin-right: 2rem;
}

.message.user {
  background: var(--secondary-color);
  color: white;
  margin-left: 2rem;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.conversation-input {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.suggested-responses {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.suggestion-btn {
  background: var(--bg-primary);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 0.5rem 1rem;
  cursor: pointer;
  font-size: 0.9rem;
  transition: var(--transition);
}

.suggestion-btn:hover {
  border-color: var(--primary-color);
  background: var(--primary-color);
  color: white;
}

#user-input {
  width: 100%;
  padding: 1rem;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: 1rem;
  resize: vertical;
  min-height: 80px;
}

.send-btn {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: var(--transition);
  align-self: flex-end;
}

.send-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.common-mistakes {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.mistake-category {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  border: 2px solid var(--border-color);
}

.mistake-category h3 {
  color: var(--danger-color);
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.mistake-examples {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.mistake-item {
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  padding: 1rem;
  border: 1px solid var(--border-light);
}

.wrong {
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  background: rgba(231, 76, 60, 0.1);
  border-radius: 0.25rem;
  border-left: 4px solid var(--danger-color);
}

.correct {
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  background: rgba(46, 204, 113, 0.1);
  border-radius: 0.25rem;
  border-left: 4px solid var(--success-color);
}

.label {
  font-weight: 700;
  margin-right: 0.5rem;
}

.explanation {
  font-size: 0.9rem;
  color: var(--text-light);
  font-style: italic;
  margin-top: 0.5rem;
}

.exercise-container {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: 2rem;
  margin-top: 2rem;
}

.exercise-item {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-light);
}

.exercise-item h3 {
  color: var(--primary-color);
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.exercise-question p {
  font-size: 1.1rem;
  margin-bottom: 1rem;
  color: var(--text-color);
}

.exercise-options {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.option-btn {
  padding: 0.75rem 1.5rem;
  border: 2px solid var(--border-color);
  background: var(--bg-primary);
  color: var(--text-color);
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: var(--transition);
  min-width: 150px;
}

.option-btn:hover {
  border-color: var(--primary-color);
  background: var(--primary-color);
  color: white;
}

.option-btn.correct {
  background: var(--success-color);
  border-color: var(--success-color);
  color: white;
}

.option-btn.incorrect {
  background: var(--danger-color);
  border-color: var(--danger-color);
  color: white;
}

.lesson-navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 2px solid var(--border-color);
}

.nav-btn {
  padding: 1rem 2rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.prev-btn {
  background: linear-gradient(135deg, var(--text-muted), var(--text-light));
  color: white;
}

.complete-btn {
  background: linear-gradient(135deg, var(--success-color), var(--secondary-color));
  color: white;
}

.nav-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

@media (max-width: 768px) {
  .lesson-content {
    padding: 1rem;
  }
  
  .conversation-scenarios {
    grid-template-columns: 1fr;
  }
  
  .expressions-categories {
    grid-template-columns: 1fr;
  }
  
  .scenario-selector {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  
  .dialogue-role {
    flex-direction: column;
    text-align: center;
  }
  
  .exercise-options {
    flex-direction: column;
  }
  
  .lesson-navigation {
    flex-direction: column;
    gap: 1rem;
  }
  
  .conversation-header {
    flex-direction: column;
    gap: 1rem;
  }
}
</style>

<script>
let currentScenario = null;
let conversationData = {
  doctor: {
    title: "زيارة الطبيب",
    aiResponses: [
      "Good morning! What brings you here today?",
      "I see. How long have you been feeling this way?",
      "Any other symptoms?",
      "Let me examine you. Please sit on the bed."
    ],
    suggestions: [
      "I have a headache",
      "I feel tired",
      "My stomach hurts",
      "I can't sleep well"
    ]
  },
  airport: {
    title: "في المطار",
    aiResponses: [
      "Good morning! Can I see your passport and ticket?",
      "How many bags are you checking in?",
      "Did you pack your bags yourself?",
      "Here's your boarding pass. Gate 15, boarding at 10:30."
    ],
    suggestions: [
      "Here you are",
      "Just one bag",
      "Yes, I packed them myself",
      "Thank you very much"
    ]
  },
  hotel: {
    title: "في الفندق",
    aiResponses: [
      "Welcome to our hotel! How can I help you?",
      "Do you have a reservation?",
      "What type of room would you like?",
      "Here's your key. Room 205, second floor."
    ],
    suggestions: [
      "I'd like to book a room",
      "Yes, under John Smith",
      "A single room for two nights",
      "Thank you. Where's the elevator?"
    ]
  },
  bank: {
    title: "في البنك",
    aiResponses: [
      "Good afternoon! How can I assist you today?",
      "I'll need to see your ID and account number.",
      "How much would you like to withdraw?",
      "Please enter your PIN on the keypad."
    ],
    suggestions: [
      "I'd like to withdraw money",
      "Here's my ID",
      "200 dollars, please",
      "Thank you for your help"
    ]
  }
};

function playDialogue(scenario) {
  console.log('Playing dialogue for scenario:', scenario);
  // هنا يمكن إضافة كود تشغيل الحوار صوتياً
}

function selectScenario(scenario) {
  currentScenario = scenario;
  
  // إزالة التحديد من جميع الخيارات
  document.querySelectorAll('.scenario-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // تحديد الخيار المختار
  event.target.closest('.scenario-option').classList.add('selected');
  
  // إظهار منطقة المحادثة
  const conversationArea = document.getElementById('conversation-area');
  conversationArea.style.display = 'block';
  
  // تحديث العنوان
  document.getElementById('current-scenario').textContent = conversationData[scenario].title;
  
  // إعادة تعيين المحادثة
  resetConversation();
  
  // بدء المحادثة
  startConversation();
}

function startConversation() {
  if (!currentScenario) return;
  
  const messagesContainer = document.getElementById('conversation-messages');
  const data = conversationData[currentScenario];
  
  // رسالة الترحيب من الذكاء الاصطناعي
  addMessage(data.aiResponses[0], 'ai');
  
  // إظهار الاقتراحات
  updateSuggestions(data.suggestions);
}

function addMessage(text, sender) {
  const messagesContainer = document.getElementById('conversation-messages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${sender}`;
  messageDiv.textContent = text;
  messagesContainer.appendChild(messageDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function updateSuggestions(suggestions) {
  const suggestionsContainer = document.getElementById('suggested-responses');
  suggestionsContainer.innerHTML = '';
  
  suggestions.forEach(suggestion => {
    const btn = document.createElement('button');
    btn.className = 'suggestion-btn';
    btn.textContent = suggestion;
    btn.onclick = () => selectSuggestion(suggestion);
    suggestionsContainer.appendChild(btn);
  });
}

function selectSuggestion(text) {
  document.getElementById('user-input').value = text;
  sendMessage();
}

function sendMessage() {
  const input = document.getElementById('user-input');
  const message = input.value.trim();
  
  if (!message || !currentScenario) return;
  
  // إضافة رسالة المستخدم
  addMessage(message, 'user');
  
  // مسح الإدخال
  input.value = '';
  
  // رد الذكاء الاصطناعي
  setTimeout(() => {
    const data = conversationData[currentScenario];
    const messagesCount = document.querySelectorAll('.message.user').length;
    
    if (messagesCount < data.aiResponses.length) {
      addMessage(data.aiResponses[messagesCount], 'ai');
    } else {
      addMessage("Thank you for practicing with us!", 'ai');
    }
  }, 1000);
}

function resetConversation() {
  document.getElementById('conversation-messages').innerHTML = '';
  document.getElementById('user-input').value = '';
  document.getElementById('suggested-responses').innerHTML = '';
}

function checkAnswer(button, isCorrect) {
  const buttons = button.parentElement.querySelectorAll('.option-btn');
  
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn === button) {
      btn.classList.add(isCorrect ? 'correct' : 'incorrect');
    } else if (btn.onclick.toString().includes('true')) {
      btn.classList.add('correct');
    }
  });
}

function previousLesson() {
  if (window.parent && window.parent.previousLesson) {
    window.parent.previousLesson();
  }
}

function completeLesson() {
  alert('🎉 مبروك! لقد أكملت جميع دروس الدورة التمهيدية لتعلم اللغة الإنجليزية!\n\nالآن يمكنك:\n• مراجعة الدروس السابقة\n• التدرب على المحادثة\n• الانتقال للمستوى التالي');
  
  if (window.parent && window.parent.completeLesson) {
    window.parent.completeLesson();
  }
}

// إضافة مستمع لمفتاح Enter في حقل الإدخال
document.addEventListener('DOMContentLoaded', function() {
  const userInput = document.getElementById('user-input');
  if (userInput) {
    userInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  }
});
</script>
